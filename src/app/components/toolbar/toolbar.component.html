<!-- Sidebar Navigation -->
<nav class="sidebar" [class.collapsed]="sidebarCollapsed">
  <div class="sidebar-header">
    <img src="assets/Logo.png" alt="Zauner Logo" class="sidebar-logo" *ngIf="!sidebarCollapsed">
    <button class="sidebar-toggle" (click)="toggleSidebar()" 
            [attr.title]="sidebarCollapsed ? 'MenÃ¼ erweitern' : 'MenÃ¼ einklappen'">
      <span class="icon">{{ sidebarCollapsed ? 'â†’' : 'â†' }}</span>
    </button>
  </div>
  
  <div class="sidebar-content">
    <!-- Drawing Tools Section -->
    <div class="tool-section">
      <div class="section-header" (click)="toggleSection('drawing')" 
           [class.active]="activeSection === 'drawing'">
        <span class="icon">âœï¸</span>
        <span class="label" *ngIf="!sidebarCollapsed">Zeichnen</span>
      </div>
    </div>

    <!-- Measurement Section -->
    <div class="tool-section">
      <div class="section-header" (click)="toggleSection('measurement')"
           [class.active]="activeSection === 'measurement'">
        <span class="icon">ğŸ“</span>
        <span class="label" *ngIf="!sidebarCollapsed">BemaÃŸung</span>
      </div>
    </div>

    <!-- Welding Section -->
    <div class="tool-section">
      <div class="section-header" (click)="toggleSection('welding')"
           [class.active]="activeSection === 'welding'">
        <span class="icon">âš¡</span>
        <span class="label" *ngIf="!sidebarCollapsed">SchweiÃŸen</span>
      </div>
    </div>

    <!-- Piping & Valves Section -->
    <div class="tool-section">
      <div class="section-header" (click)="toggleSection('piping')"
           [class.active]="activeSection === 'piping'">
        <span class="icon">ğŸš°</span>
        <span class="label" *ngIf="!sidebarCollapsed">Rohrleitungen</span>
      </div>
    </div>

    <!-- Isometry Section -->
    <div class="tool-section">
      <div class="section-header" (click)="toggleSection('isometry')"
           [class.active]="activeSection === 'isometry'">
        <span class="icon">ğŸ“</span>
        <span class="label" *ngIf="!sidebarCollapsed">Isometrien</span>
      </div>
    </div>

    <!-- Object Management Section -->
    <div class="tool-section">
      <div class="section-header" (click)="toggleSection('objects')"
           [class.active]="activeSection === 'objects'">
        <span class="icon">ğŸ“¦</span>
        <span class="label" *ngIf="!sidebarCollapsed">Objekte</span>
      </div>
    </div>
  </div>

  <!-- Bottom Actions -->
  <div class="sidebar-footer" *ngIf="!sidebarCollapsed">
    <div class="snap-controls">
      <label class="snap-label">Snap-Optionen</label>
      <div class="snap-buttons">
        <button class="snap-btn" 
                (click)="toggleSnapTo15Angle()" 
                [class.active]="snapTo15Angle"
                title="15Â° Raster">
          15Â°
        </button>
        <button class="snap-btn" 
                (click)="toggleSnapToAngle()" 
                [class.active]="snapToAngle"
                title="30Â° Raster">
          30Â°
        </button>
        <button class="snap-btn" 
                (click)="toggleSnapTo45Angle()" 
                [class.active]="snapTo45Angle"
                title="45Â° Raster">
          45Â°
        </button>
      </div>
    </div>
    <div class="divider"></div>
    <div class="color-controls">
      <label class="color-label">Farbmodus</label>
      <div class="color-buttons">
        <button class="color-btn" 
                (click)="setColorMode('drawing')" 
                [class.active]="colorMode === 'drawing'"
                title="Zeichnen Modus">
          Zeichnen
        </button>
        <button class="color-btn" 
                (click)="setColorMode('blackwhite')" 
                [class.active]="colorMode === 'blackwhite'"
                title="Schwarz-WeiÃŸ Modus">
          S/W
        </button>
        <button class="color-btn" 
                (click)="setColorMode('norm')" 
                [class.active]="colorMode === 'norm'"
                title="DIN ISO Norm">
          Norm
        </button>
      </div>
    </div>
    <div class="divider"></div>
    <button class="footer-btn" (click)="showHelp()" title="Hilfe">
      <span>â“ Hilfe</span>
    </button>
    <button class="footer-btn" (click)="showSettings()" title="Einstellungen">
      <span>âš™ï¸ Einstellungen</span>
    </button>
  </div>
</nav>

<!-- Top Context Bar -->
<div class="top-context-bar" [class.collapsed]="sidebarCollapsed">
  <!-- Drawing Tools -->
  <div class="context-section" *ngIf="activeSection === 'drawing'">
    <button class="context-btn" (click)="addLine()" 
            [class.active]="drawingService.drawingMode === 'addLine'"
            title="Linie zeichnen">
      <span class="icon">ğŸ“</span>
      <span class="label">Linie</span>
    </button>
    <button class="context-btn" (click)="startPiping()" 
            [class.active]="drawingService.drawingMode === 'addPipe'"
            title="Rohrleitung zeichnen">
      <span class="icon">ğŸ”§</span>
      <span class="label">Rohrleitung</span>
    </button>
    <button class="context-btn" (click)="addText()" 
            [class.active]="drawingService.drawingMode === 'text'"
            title="Text hinzufÃ¼gen">
      <span class="icon">ğŸ“</span>
      <span class="label">Text</span>
    </button>
    <button class="context-btn" (click)="addAnchors()" 
            [class.active]="drawingService.drawingMode === 'addAnchors'"
            title="Ankerpunkte setzen">
      <span class="icon">ğŸ“</span>
      <span class="label">Ankerpunkte</span>
    </button>
  </div>

  <!-- Measurement Tools -->
  <div class="context-section" *ngIf="activeSection === 'measurement'">
    <button class="context-btn" (click)="setDimensionMode()" 
            [class.active]="drawingService.drawingMode === 'dimension' && !drawingService.dimensionService?.isoDimensionMode"
            title="BemaÃŸung hinzufÃ¼gen">
      <span class="icon">ğŸ“</span>
      <span class="label">Dimension</span>
    </button>
    <button class="context-btn" (click)="setIsoDimensionMode()" 
            [class.active]="drawingService.drawingMode === 'dimension' && drawingService.dimensionService?.isoDimensionMode"
            title="ISO-BemaÃŸung (TAB fÃ¼r Ausrichtung)">
      <span class="icon">ğŸ“</span>
      <span class="label">ISO-Dimension</span>
    </button>
    <button class="context-btn" (click)="applyDimension()"
            title="BemaÃŸung anwenden">
      <span class="icon">âœ…</span>
      <span class="label">Anwenden</span>
    </button>
  </div>

  <!-- Welding Tools -->
  <div class="context-section" *ngIf="activeSection === 'welding'">
    <button class="context-btn" (click)="startWeldstamp()" 
            [class.active]="drawingService.drawingMode === 'weldstamp'"
            title="SchweiÃŸstempel">
      <span class="icon">ğŸ”´</span>
      <span class="label">SchweiÃŸstempel</span>
    </button>
    <button class="context-btn" (click)="startWelderStamp()" 
            [class.active]="drawingService.drawingMode === 'welderstamp'"
            title="SchweiÃŸer Stempel">
      <span class="icon">ğŸ‘·</span>
      <span class="label">SchweiÃŸer</span>
    </button>
    <button class="context-btn" (click)="startWelderStampEmpty()" 
            [class.active]="drawingService.drawingMode === 'welderstampempty'"
            title="SchweiÃŸer Stempel leer">
      <span class="icon">â­•</span>
      <span class="label">SchweiÃŸer leer</span>
    </button>
    <button class="context-btn" (click)="startWelderStampAS()" 
            [class.active]="drawingService.drawingMode === 'welderstampas'"
            title="SchweiÃŸer Stempel AS">
      <span class="icon">ğŸ”µ</span>
      <span class="label">SchweiÃŸer AS</span>
    </button>
    <button class="context-btn" (click)="startWeld()" 
            [class.active]="drawingService.drawingMode === 'weld'"
            title="SchweiÃŸnaht">
      <span class="icon">âœ–ï¸</span>
      <span class="label">SchweiÃŸnaht</span>
    </button>
    <button class="context-btn" (click)="startFluidStamp()" 
            [class.active]="drawingService.drawingMode === 'fluidstamp'"
            title="Flansch Stempel">
      <span class="icon">â¬¡</span>
      <span class="label">Flansch</span>
    </button>
    <button class="context-btn" (click)="startSpool()" 
            [class.active]="drawingService.drawingMode === 'spool'"
            title="Spool">
      <span class="icon">ğŸ”„</span>
      <span class="label">Spool</span>
    </button>
  </div>

  <!-- Piping Tools -->
  <div class="context-section" *ngIf="activeSection === 'piping'">
    <button class="context-btn" (click)="startPiping()" 
            [class.active]="drawingService.drawingMode === 'addPipe'"
            title="Rohrleitung zeichnen">
      <span class="icon">ğŸ”§</span>
      <span class="label">Rohrleitung</span>
    </button>
    <button class="context-btn" (click)="startFlow()" 
            [class.active]="drawingService.drawingMode === 'flow'"
            title="FlieÃŸrichtung">
      <span class="icon">â¡ï¸</span>
      <span class="label">FlieÃŸrichtung</span>
    </button>
    
    <div class="separator"></div>
    
    <!-- Valve Options -->
    <div class="valve-group">
      <span class="group-label">Ventile:</span>
      <button class="valve-btn" (click)="toggleGateValve()"
              [class.active]="showGateValveTools">
        Gate
      </button>
      <button class="valve-btn" (click)="toggleGlobeValve()"
              [class.active]="showGlobeValveTools">
        Globe
      </button>
      <button class="valve-btn" (click)="toggleBallValve()"
              [class.active]="showBallValveTools">
        Ball
      </button>
    </div>

    <!-- Gate Valve Options -->
    <div class="valve-options" *ngIf="showGateValveTools">
      <span class="option-label">Gate:</span>
      <button class="option-btn" (click)="startGateValveS()" 
              [class.active]="drawingService.drawingMode === 'gateValveS'">S</button>
      <button class="option-btn" (click)="startGateValveFL()" 
              [class.active]="drawingService.drawingMode === 'gateValveFL'">FL</button>
    </div>

    <!-- Globe Valve Options -->
    <div class="valve-options" *ngIf="showGlobeValveTools">
      <span class="option-label">Globe:</span>
      <button class="option-btn" (click)="startGlobeValveS()" 
              [class.active]="drawingService.drawingMode === 'globeValveS'">S</button>
      <button class="option-btn" (click)="startGlobeValveFL()" 
              [class.active]="drawingService.drawingMode === 'globeValveFL'">FL</button>
    </div>

    <!-- Ball Valve Options -->
    <div class="valve-options" *ngIf="showBallValveTools">
      <span class="option-label">Ball:</span>
      <button class="option-btn" (click)="startBallValveS()" 
              [class.active]="drawingService.drawingMode === 'ballValveS'">S</button>
      <button class="option-btn" (click)="startBallValveFL()" 
              [class.active]="drawingService.drawingMode === 'ballValveFL'">FL</button>
    </div>
  </div>

  <!-- Isometry Tools -->
  <div class="context-section" *ngIf="activeSection === 'isometry'">
    <button class="context-btn" (click)="startSlope()"
            [class.active]="drawingService.drawingMode === 'slope'"
            title="GefÃ¤lle markieren">
      <span class="icon">ğŸ”»</span>
      <span class="label">GefÃ¤lle</span>
    </button>
  </div>

  <!-- Object Management Tools -->
  <div class="context-section" *ngIf="activeSection === 'objects'">
    <button class="context-btn" (click)="groupSelectedObjects()"
            title="Objekte gruppieren">
      <span class="icon">ğŸ”—</span>
      <span class="label">Gruppieren</span>
    </button>
    <button class="context-btn" (click)="ungroupObjects()"
            title="Gruppierung aufheben">
      <span class="icon">ğŸ”“</span>
      <span class="label">Aufheben</span>
    </button>
  </div>

  <!-- Status Info -->
  <div class="status-info">
    <span class="status-label">Modus:</span>
    <span class="current-mode" [class.active]="drawingService.drawingMode !== 'idle'">
      {{ getCurrentModeLabel() }}
    </span>
    <span class="help-text" *ngIf="drawingService.drawingMode !== 'idle'">
      | {{ getContextualHelp() }}
    </span>
  </div>
</div>